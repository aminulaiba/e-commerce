<div id="step-2-content" class="page-content max-w-3xl mx-auto">
    <h2 class="text-2xl font-bold mb-8 text-center text-gray-900">Secure Checkout</h2>

    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl space-y-8">
        <form action="{% url 'place-order' %}" method="POST" id="deliveryForm">
            {% csrf_token %}
            {% if request.user.is_authenticated %}
                <!-- Saved address Section -->
                <div class="border-b pb-6 border-gray-100">
                    <h3 class="text-xl font-semibold mb-4 flex items-center text-gray-800">
                        <i data-lucide="truck" class="w-6 h-6 mr-3 text-green-500"></i>
                        Saved Addresses
                    </h3>
                    <div class="space-y-3">
                        {% for adrs in saved_addresses %}
                            <label class="flex items-center p-4 bg-gray-50 border-2 border-transparent rounded-xl cursor-pointer hover:border-gray-300 transition duration-150 has-[:checked]:border-indigo-500">
                                <input type="radio" name="shipping_address" value="{{ adrs.id }}" {% if adrs.is_default %} checked {% endif %} class="h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                <span class="ml-4 font-medium text-gray-900 flex-grow">{{ adrs }}</span>
                                <i data-lucide="map-pin-house" class="w-6 h-6 text-gray-500"></i>
                            </label>
                        {% endfor %}
                        <div>
                            <a href="{% url 'shippingaddress-add' %}">
                                <div class="flex items-center justify-center p-4 bg-gray-50 border-2 border-transparent rounded-xl cursor-pointer hover:border-gray-300 transition duration-150 has-[:checked]:border-indigo-500">
                                    <i data-lucide="circle-plus" class="w-6 h-6 text-gray-500"></i>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            {% else %}
                <!-- Shipping Address Section -->
                <div class="border-b pb-6 border-gray-100">
                    <h3 class="text-xl font-semibold mb-4 flex items-center text-gray-800">
                        <i data-lucide="package" class="w-6 h-6 mr-3 text-indigo-500"></i>
                        Delivery Information
                    </h3>
                    <input type="text" name="first_name" placeholder="First Name" class="col-span-1 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
                    <input type="text" name="last_name" placeholder="Last Name" class="col-span-1 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
                    <input type="text" name="address" placeholder="Address Line 1" class="col-span-2 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
                    <input type="text" name="city" placeholder="City" class="col-span-1 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
                    <input type="text" name="zip_code" placeholder="Zip/Postal Code" class="col-span-1 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
                    <input type="email" name="email" placeholder="Email Address" class="col-span-2 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>


                </div>
            {% endif %}
                <!-- Payment Method Section -->
                <div>
                    <h3 class="text-xl font-semibold mb-4 flex items-center text-gray-800">
                        <i data-lucide="credit-card" class="w-6 h-6 mr-3 text-green-500"></i>
                        Payment Details
                    </h3>
                    <div class="space-y-4">
                        <label class="flex items-center p-4 bg-gray-50 border-2 border-transparent rounded-xl cursor-pointer hover:border-gray-300 transition duration-150 has-[:checked]:border-indigo-500">
                            <input type="radio" name="payment" value="card" checked class="h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                            <span class="ml-4 font-medium text-gray-900 flex-grow">Credit Card (Visa/Mastercard)</span>
                            <i data-lucide="square-mouse-pointer" class="w-6 h-6 text-gray-500"></i>
                        </label>
                        <label class="flex items-center p-4 bg-gray-50 border-2 border-transparent rounded-xl cursor-pointer hover:border-gray-300 transition duration-150 has-[:checked]:border-indigo-500">
                            <input type="radio" name="payment" value="paypal" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                            <span class="ml-4 font-medium text-gray-900 flex-grow">PayPal / Digital Wallet</span>
                            <i data-lucide="wallet" class="w-6 h-6 text-gray-500"></i>
                        </label>
                    </div>
                </div>

            <!-- Final Action Buttons -->
            <div class="flex flex-col sm:flex-row justify-between gap-4 pt-4 border-t border-gray-200">
                <button onclick="goToStep(1)" class="w-full sm:w-1/3 flex items-center justify-center px-6 py-3 bg-gray-100 text-gray-800 text-base font-medium rounded-xl hover:bg-gray-200 transition duration-150">
                    <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i>
                    Back to Cart
                </button>
                <button type="button" onclick="placeOrder()" class="w-full sm:w-2/3 flex items-center justify-center px-6 py-3 bg-black text-white text-lg font-semibold rounded-xl shadow-2xl shadow-black/20 hover:bg-gray-800 transition duration-150 transform hover:scale-[1.01]">
                    Confirm & Pay ({{ total }}à§³)
                </button>
            </div>
        </form>
    </div>
</div>